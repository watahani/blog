<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="以前、「Edge が WebAuthN をサポートしたらしいので色々試してみた(Insider Preview)」という記事を書いた。">
<meta property="og:type" content="article">
<meta property="og:title" content="Webauthn における ResidentKey と UserVerification について">
<meta property="og:url" content="http://blog.haniyama.com/2018/10/19/webauthn-residentkey/index.html">
<meta property="og:site_name" content="enjoy struggling">
<meta property="og:description" content="以前、「Edge が WebAuthN をサポートしたらしいので色々試してみた(Insider Preview)」という記事を書いた。">
<meta property="og:locale">
<meta property="og:image" content="http://blog.haniyama.com/2018/10/19/webauthn-residentkey/u2fbase.png">
<meta property="og:image" content="http://blog.haniyama.com/2018/10/19/webauthn-residentkey/06_credentials.png">
<meta property="article:published_time" content="2018-10-19T13:12:53.000Z">
<meta property="article:modified_time" content="2022-05-18T13:45:29.145Z">
<meta property="article:author" content="watahani">
<meta property="article:tag" content="FIDO2">
<meta property="article:tag" content="YubiKey">
<meta property="article:tag" content="WebAuthn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.haniyama.com/2018/10/19/webauthn-residentkey/u2fbase.png">
<meta name="twitter:creator" content="@watahani"><meta name="description"><meta name="keywords" content="Java, Javascript, AWS, GCP, PGP"><link rel="alternate" type="application/atom+xml" href="/atom.xml" title="enjoy struggling"><title>Webauthn における ResidentKey と UserVerification について - enjoy struggling</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.png"><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-113476970-1', 'auto');ga('send', 'pageview');</script><meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a target="_blank" rel="noopener" href="https://github.com/watahani"><span>Github</span></a></li><li><a target="_blank" rel="noopener" href="https://qiita.com/watahani"><span>Qiita</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><link rel="amphtml" href="./amp/index.html"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://storage.googleapis.com/blog-haniyama/background-min.png"><div class="post-title"><h1 class="title">Webauthn における ResidentKey と UserVerification について</h1><ul class="meta"><li><i class="icon icon-author"></i>watahani</li><li><i class="icon icon-clock"></i>21 Minutes</li><li><i class="icon icon-calendar"></i>October 19, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><p>以前、「Edge が WebAuthN をサポートしたらしいので色々試してみた(Insider Preview)」という記事を書いた。</p>
<span id="more"></span>


<ul>
<li>これ: <a href="/2018/06/17/edge-support-webauthn/">Edge が WebAuthN をサポートしたらしいので色々試してみた(Insider Preview)</a></li>
</ul>
<p>ありがたいことに、結構な方に見ていただいて、あの記事参考になったよと直接言っていただいたり、fidcon で話すことになったり。</p>
<p>ただ、あの記事は当時私が良く分かっていなかった ResidentKey に関する適当な記述があり、そこで引っ掛かってしまっている方もいるようなので、今更感はあるけど、改めて ResidentKey の話をしようと思う。</p>
<h2 id="Resident"><a href="#Resident" class="headerlink" title="Resident"></a>Resident</h2><p>私は英語が苦手なので、Resident って何やねんと思ってるのだが、辞書的には</p>
<blockquote>
<p>研究社 新英和中辞典での「resident」の意味<br>resident<br>形容詞</p>
<p>1居住する，在住の.</p>
<p>2 a 駐在の，住み込みの.<br>  b 専属の.<br>  c 叙述的用法の形容詞 〔前+(代)名〕〔…に〕居住して 〔at，in〕.</p>
<p>3【動物, 動物学】〈鳥など〉季節的に移動しない (⇔migratory).</p>
<p>4 叙述的用法の形容詞 〔+in+(代)名〕〈性質・権利など〉〔…に〕内在して，固有で.</p>
</blockquote>
<p>ということで、内在しており「移動しない」といった意味がありそう。</p>
<p>実際にWebAuthn の文脈でも “ResidentKey” には  Authenticator に内在し移動しない <strong>Credential</strong> を保存できるものを指すので、間違ってはいなさそう。<br>では、保存される <strong>Credential</strong> って何なの？っていうのは、WebAuthn のスペックだと、</p>
<blockquote>
<p>… public key credential source whose credential private key is stored in the authenticator, client or client device. Such client-side storage requires a resident credential capable authenticator and has the property that the authenticator is able to select the credential private key given only an RP ID, possibly with user assistance (e.g., by providing the user a pick list of credentials scoped to the RP ID).<br>…<br><a target="_blank" rel="noopener" href="https://w3c.github.io/webauthn/#resident-credential">https://w3c.github.io/webauthn/#resident-credential</a></p>
</blockquote>
<p>ということで、保存される <strong>Credential</strong> は <strong>public key credential source</strong> らしい。<br><strong>public key credential source</strong> を保存した結果、<strong>RP ID</strong> のみを与えられた場合に、rp に関連する Credential をユーザが選択可能になる、と。</p>
<p>で <strong><a target="_blank" rel="noopener" href="https://w3c.github.io/webauthn/#public-key-credential-source">public key credential source</a></strong> ってのは</p>
<ul>
<li>public key credential source<ul>
<li>type: public-key.</li>
<li>CredentialId.</li>
<li>privateKey</li>
<li>rpId</li>
<li>userHandle</li>
<li>otherUI (user.name, displayName, rp.name ..etc)</li>
</ul>
</li>
</ul>
<p>のことらしい。</p>
<p>このあたりは、以前 #fidcon で少し話した通り。</p>
<p>もともとの U2F ベースの認証だと、認証の際に「どのキーペアか」を示す <strong>CredentialId</strong> を指定してやらないといけないので、事前にユーザーの特定、一般的には ID&#x2F;Password の認証が必要となってくる。ここではユーザーの特定さえできればよいので、社内システムとか CredentialId が他の利用者に漏れてもいいようなシステムなら、ID 入力(Credential の特定）だけで、全社員分の CredentialId を返すとかでもいいっちゃいいのかもしれないけどふつうは困るので ID&#x2F;Password 認証とのセットが必要になるだろう。</p>
<p>まあ、とにかく <strong>CredentialId</strong> が認証の際に必要だったわけ。</p>
<p><img src="/2018/10/19/webauthn-residentkey/u2fbase.png"></p>
<p>それだとパスワードレス認証にならないので WebAuthn では ResidentKey といって、<strong>CredentialId</strong> をキーに保存しておける仕組みを作った。実際には user や rp の情報も一緒に保存するので、RP の情報や、ユーザ情報も保存される。</p>
<p>そのおかげて、 RP だけ与えられた際に、RPの情報や保存されたユーザ情報で、ユーザはどの Credential を利用しようとしているかが理解できる。</p>
<p><img src="/2018/10/19/webauthn-residentkey/06_credentials.png"></p>
<h2 id="User-Verification"><a href="#User-Verification" class="headerlink" title="User Verification"></a>User Verification</h2><p>で、ここからが前の記事で勘違いしていた部分。</p>
<p>保存しておいた Credential がタッチで簡単に取り出せては困るので、U2F の際にはなかった User Verification (UV) 本人確認の仕組みがキーに備わっている。</p>
<p>ただし、これは optional であって必須ではない。</p>
<p>つまり、User Verification なしでもパスワードレス認証をすることは可能ということ。<br>なんとなく表にまとめるとこんな具合だと思う。</p>
<table>
<thead>
<tr>
<th align="center">ResidentKey</th>
<th align="center">User Verificaiton</th>
<th align="center">platform</th>
<th align="left">例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">〇</td>
<td align="center">〇</td>
<td align="center">internal</td>
<td align="left">スマホ・PCの生体 or PIN</td>
</tr>
<tr>
<td align="center">×</td>
<td align="center">〇</td>
<td align="center">internal</td>
<td align="left">ID&#x2F;Pass + スマホ・PCの生体 or PIN</td>
</tr>
<tr>
<td align="center">〇</td>
<td align="center">〇</td>
<td align="center">external</td>
<td align="left">YubiKeyなどの外部デバイス(生体 or PIN)</td>
</tr>
<tr>
<td align="center">〇</td>
<td align="center">×</td>
<td align="center">external</td>
<td align="left">YubiKeyなどの外部デバイス(タッチのみ)</td>
</tr>
<tr>
<td align="center">×</td>
<td align="center">〇</td>
<td align="center">external</td>
<td align="left">ID&#x2F;Pass + YubiKeyなどの外部デバイス(生体 or PIN)</td>
</tr>
<tr>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">external</td>
<td align="left">ID&#x2F;Pass + YubiKeyなどの外部デバイス(タッチのみ)</td>
</tr>
</tbody></table>
<p>分かりにくいｗ</p>
<p>以前の記事では、YubiKeyなどの外部デバイスでタッチのみの認証ができなさそうと書いてたけれども ResidentKey のオプションを指定していないだけだった。</p>
<p>だからと言って、タッチだけでログインできるっていうユースケースどんだけあんねんって話ではある。NFC のタッチだけでログインできるっていうのは PIN の入力や、YubiKey にタッチができないような現場での認証には使えるかもしれないけど。</p>
<h2 id="User-Verification-の罠"><a href="#User-Verification-の罠" class="headerlink" title="User Verification の罠"></a>User Verification の罠</h2><p>User Verification には少し罠があって、何かというと、上記例から外した</p>
<table>
<thead>
<tr>
<th>ResidentKey</th>
<th>User Verificaiton</th>
<th>platform</th>
<th>例</th>
</tr>
</thead>
<tbody><tr>
<td>×</td>
<td>×</td>
<td>〇</td>
<td>ID&#x2F;Pass + スマホ・PCの生体 or PIN</td>
</tr>
</tbody></table>
<p>だが、スマホや PC で UV がない認証がないけど、これってどうなるの？</p>
<p>手元の Windows 10 RS5 で</p>
<pre class="language-js" style="" tabindex="0"><code id="90c5093d" class="language-js" data-prism-hydrate="{&quot;element&quot;:&quot;90c5093d&quot;,&quot;language&quot;:&quot;js&quot;,&quot;code&quot;:&quot;\n\&quot;authenticatorSelection\&quot;:{\n    \&quot;authenticatorAttachment\&quot;:\&quot;platform\&quot;,\n    \&quot;userVerification\&quot;:\&quot;discouraged\&quot;,\n    \&quot;requireResidentKey\&quot;:false\n}\n&quot;,&quot;highlightedCode&quot;:&quot;\n\u003cspan class=\&quot;token string-property property\&quot;\u003e\&quot;authenticatorSelection\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token punctuation\&quot;>{</span>\n    <span class=\&quot;token string-property property\&quot;>\&quot;authenticatorAttachment\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;platform\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span>\n    <span class=\&quot;token string-property property\&quot;>\&quot;userVerification\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;discouraged\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span>\n    <span class=\&quot;token string-property property\&quot;>\&quot;requireResidentKey\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token boolean\&quot;>false</span>\n<span class=\&quot;token punctuation\&quot;>}</span>\n&quot;}">
<span class="token string-property property">"authenticatorSelection"</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">"authenticatorAttachment"</span><span class="token operator">:</span><span class="token string">"platform"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userVerification"</span><span class="token operator">:</span><span class="token string">"discouraged"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"requireResidentKey"</span><span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>

<p>で試してみたけど、PIN や 指紋の入力が必須だった。</p>
<blockquote>
<p>手元に RS5 以降の Edge がある人は、以下をコピペしてコンソールに張り付けてみよう。色々試してみると面白いかも。</p>
</blockquote>
<pre class="language-js" style="" tabindex="0"><code id="2649043f" class="language-js" data-prism-hydrate="{&quot;element&quot;:&quot;2649043f&quot;,&quot;language&quot;:&quot;js&quot;,&quot;code&quot;:&quot;\nnavigator.credentials.create({\n    \&quot;publicKey\&quot;: {\n        \&quot;rp\&quot;:{\&quot;test\&quot;},\n            \&quot;user\&quot;:{\&quot;displayName\&quot;:\&quot;test\&quot;,\n            \&quot;name\&quot;:\&quot;test@example.com\&quot;,\n            \&quot;id\&quot;:new Uint32Array(16)\n        },\n        \&quot;challenge\&quot;:new Uint32Array(32),\n        \&quot;pubKeyCredParams\&quot;:[\n            {\&quot;type\&quot;:\&quot;public-key\&quot;,\&quot;alg\&quot;:-7},{\&quot;type\&quot;:\&quot;public-key\&quot;,\&quot;alg\&quot;:-257}\n        ],\n        \&quot;excludeCredentials\&quot;:[],\n        \&quot;authenticatorSelection\&quot;:{\n            \&quot;authenticatorAttachment\&quot;:\&quot;platform\&quot;,\&quot;userVerification\&quot;:\&quot;discouraged\&quot;,\n            \&quot;requireResidentKey\&quot;:false}\n        }\n    })\n&quot;,&quot;highlightedCode&quot;:&quot;\nnavigator\u003cspan class=\&quot;token punctuation\&quot;\u003e.</span>credentials<span class=\&quot;token punctuation\&quot;>.</span><span class=\&quot;token function\&quot;>create</span><span class=\&quot;token punctuation\&quot;>(</span><span class=\&quot;token punctuation\&quot;>{</span>\n    <span class=\&quot;token string-property property\&quot;>\&quot;publicKey\&quot;</span><span class=\&quot;token operator\&quot;>:</span> <span class=\&quot;token punctuation\&quot;>{</span>\n        <span class=\&quot;token string-property property\&quot;>\&quot;rp\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token punctuation\&quot;>{</span><span class=\&quot;token string\&quot;>\&quot;test\&quot;</span><span class=\&quot;token punctuation\&quot;>}</span><span class=\&quot;token punctuation\&quot;>,</span>\n            <span class=\&quot;token string-property property\&quot;>\&quot;user\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token punctuation\&quot;>{</span><span class=\&quot;token string-property property\&quot;>\&quot;displayName\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;test\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span>\n            <span class=\&quot;token string-property property\&quot;>\&quot;name\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;test@example.com\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span>\n            <span class=\&quot;token string-property property\&quot;>\&quot;id\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token keyword\&quot;>new</span> <span class=\&quot;token class-name\&quot;>Uint32Array</span><span class=\&quot;token punctuation\&quot;>(</span><span class=\&quot;token number\&quot;>16</span><span class=\&quot;token punctuation\&quot;>)</span>\n        <span class=\&quot;token punctuation\&quot;>}</span><span class=\&quot;token punctuation\&quot;>,</span>\n        <span class=\&quot;token string-property property\&quot;>\&quot;challenge\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token keyword\&quot;>new</span> <span class=\&quot;token class-name\&quot;>Uint32Array</span><span class=\&quot;token punctuation\&quot;>(</span><span class=\&quot;token number\&quot;>32</span><span class=\&quot;token punctuation\&quot;>)</span><span class=\&quot;token punctuation\&quot;>,</span>\n        <span class=\&quot;token string-property property\&quot;>\&quot;pubKeyCredParams\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token punctuation\&quot;>[</span>\n            <span class=\&quot;token punctuation\&quot;>{</span><span class=\&quot;token string-property property\&quot;>\&quot;type\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;public-key\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span><span class=\&quot;token string-property property\&quot;>\&quot;alg\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token operator\&quot;>-</span><span class=\&quot;token number\&quot;>7</span><span class=\&quot;token punctuation\&quot;>}</span><span class=\&quot;token punctuation\&quot;>,</span><span class=\&quot;token punctuation\&quot;>{</span><span class=\&quot;token string-property property\&quot;>\&quot;type\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;public-key\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span><span class=\&quot;token string-property property\&quot;>\&quot;alg\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token operator\&quot;>-</span><span class=\&quot;token number\&quot;>257</span><span class=\&quot;token punctuation\&quot;>}</span>\n        <span class=\&quot;token punctuation\&quot;>]</span><span class=\&quot;token punctuation\&quot;>,</span>\n        <span class=\&quot;token string-property property\&quot;>\&quot;excludeCredentials\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token punctuation\&quot;>[</span><span class=\&quot;token punctuation\&quot;>]</span><span class=\&quot;token punctuation\&quot;>,</span>\n        <span class=\&quot;token string-property property\&quot;>\&quot;authenticatorSelection\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token punctuation\&quot;>{</span>\n            <span class=\&quot;token string-property property\&quot;>\&quot;authenticatorAttachment\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;platform\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span><span class=\&quot;token string-property property\&quot;>\&quot;userVerification\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token string\&quot;>\&quot;discouraged\&quot;</span><span class=\&quot;token punctuation\&quot;>,</span>\n            <span class=\&quot;token string-property property\&quot;>\&quot;requireResidentKey\&quot;</span><span class=\&quot;token operator\&quot;>:</span><span class=\&quot;token boolean\&quot;>false</span><span class=\&quot;token punctuation\&quot;>}</span>\n        <span class=\&quot;token punctuation\&quot;>}</span>\n    <span class=\&quot;token punctuation\&quot;>}</span><span class=\&quot;token punctuation\&quot;>)</span>\n&quot;}">
navigator<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">"publicKey"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">"rp"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"user"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">"displayName"</span><span class="token operator">:</span><span class="token string">"test"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"test@example.com"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"id"</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">"challenge"</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">"pubKeyCredParams"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"public-key"</span><span class="token punctuation">,</span><span class="token string-property property">"alg"</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"public-key"</span><span class="token punctuation">,</span><span class="token string-property property">"alg"</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">257</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">"excludeCredentials"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">"authenticatorSelection"</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token string-property property">"authenticatorAttachment"</span><span class="token operator">:</span><span class="token string">"platform"</span><span class="token punctuation">,</span><span class="token string-property property">"userVerification"</span><span class="token operator">:</span><span class="token string">"discouraged"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"requireResidentKey"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>

<h2 id="UVをいったん使うと…"><a href="#UVをいったん使うと…" class="headerlink" title="UVをいったん使うと…"></a>UVをいったん使うと…</h2><blockquote>
<p>User Presence だけの認証は確かにできる。ただし。</p>
</blockquote>
<p>これはどういう話かというと、</p>
<p>User Presence だけの認証ができるのは Authenticator が一度も UV オプションを設定していなかった場合（あるいは対応していない場合）のみで、platform の Authenticator は、基本 UV が必須なので、オプションがオフでも UV のアクションが必須になる。</p>
<p>というのも、 userVerification のオプションは “required”, “preffered’, “discourage” で、つまり “必須”, “あれば”, “なくてもいい” で、”なしで” のオプションがない。</p>
<p>これは外部 Authenticator も一緒で、たとえば一旦 PIN を設定した YubiKey は、 User Verification オプションをオフにしても PIN の入力が求められることになる。</p>
<p>つまり、サービスA でタッチだけでログインしていたとして(discourage)、他のサービスBで UV が必須(required)だったとする。そこで、サービスB に登録するために新しく PIN を設定すると、サービスA でも PIN が必要になるということ。</p>
<p>そんなんどこに書いてあんねんってのは、CTAP2 の仕様に書いてあったように思うけど、探しても見つからない。</p>
<p>最近 Silent Auth の話も進んでるから意図的に削られたのか、単に見つけられないだけなのか、前見たってのが勘違いなのか…。</p>
<p>どなたかこのあたり詳しい人教えてほしい。</p>
<p>ともかく、こんな話なので、タップでログインしていたユーザーが何かのはずみで PIN を設定してしまうと、PIN ログインが必須になってしまい、二度と解除できなくなってしまう。</p>
<p>うーん、それってどうなん？<br>そもそも物理キー買う層は User Verification 使うぐらいセキュリティ意識高いから平気って話なのか。それだったらタップだけ(User Presense) な認証は禁止にすりゃいいのに。Key側の設定でオンオフできればいいんだけど。とか。</p>
<p>個人的にすごく気になってるので、今後もこのあたりの議論を追っていかなきゃなー。</p>
<p>いじょ。</p>
<div class="related-post"><h3>関連記事</h3><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\2018\06\17\edge-support-webauthn\" title="Edge が WebAuthN をサポートしたらしいので色々試してみた(Insider Preview)" rel="bookmark">Edge が WebAuthN をサポートしたらしいので色々試してみた(Insider Preview)</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\2018\09\28\ms-ignite-2018\" title="雑感 Microsoft Ignite What's new for Windows Hello for Business" rel="bookmark">雑感 Microsoft Ignite What's new for Windows Hello for Business</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\2019\07\15\azuread-fido2-security-key-public-preview\" title="Azure AD の FIDO2 Security Key 対応のパブリックプレビューが来たー" rel="bookmark">Azure AD の FIDO2 Security Key 対応のパブリックプレビューが来たー</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\2018\11\21\msa-login-with-securitykey\" title="Microsoft Account FIDO2 対応キーでログイン可能に" rel="bookmark">Microsoft Account FIDO2 対応キーでログイン可能に</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="\2019\05\07\windows-hello-fido2-certification\" title="Windows Hello が FIDO2 Certificate を取得" rel="bookmark">Windows Hello が FIDO2 Certificate を取得</a></h3></div></li></ul></div></div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/FIDO2/" rel="tag">FIDO2</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebAuthn/" rel="tag">WebAuthn</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YubiKey/" rel="tag">YubiKey</a><span class="tag-list-count">10</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/11/19/webauthn-attestation/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/10/13/techbook-fest-5/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/82p" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://twitter.com/watahani" title="Twitter" target="_blank"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.facebook.com/haniyama.wataru" title="Facebook" target="_blank"><i class="icon icon-facebook"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2024 enjoy struggling<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>